programa ej3Clase5

procesos
  
  proceso enviarQuienSoy(ES quienSoy:numero)
  comenzar
    si PosAv=1
      quienSoy:=1
      EnviarMensaje(1,robServidor)
    sino
      si PosAv=2
        quienSoy:=2
        EnviarMensaje(2,robServidor)
      sino
        si PosAv=3
          quienSoy:=3
          EnviarMensaje(3,robServidor)  
  fin

areas
  esqServidor: AreaP (100,100,100,100)
  av1: AreaPC (1,1,1,100)
  av2: AreaPC (2,1,2,100)
  av3: AreaPC (3,1,3,100)
  
robots

  robot tipoCliente
  variables
    cantF:numero
    quienSoy:numero
    avanzar:numero
    avAct,caAct:numero
    floresDep:numero
    termine:numero
  comenzar
    mientras (PosCa<=99)
      floresDep:=0
      termine:=0
      avAct:=PosAv
      caAct:=PosCa
      Random(cantF,1,4)                
      enviarQuienSoy(quienSoy)     
      si termine=1       
        EnviarMensaje(0,robServidor)  
      sino
        EnviarMensaje(cantF,robServidor)
        EnviarMensaje(avAct,robServidor)
        EnviarMensaje(caAct,robServidor)       
        RecibirMensaje(avanzar,robServidor)
        mover
        mientras HayFlorEnLaEsquina         
          tomarFlor
          floresDep:=floresDep+1
        Pos(avAct,caAct)
        mientras (PosCa<=99) & (floresDep>0)
          depositarFlor
          floresDep:=floresDep-1
          mover  
        si (PosCa=100)
          termine:=1
  fin

  robot tipoServidor
  variables
    quienSos:numero
    cantF:numero
    av,ca:numero
    termine1,termine2,termine3:numero
  comenzar
    termine1:=0
    termine2:=0
    termine3:=0
    mientras ((termine1<>1) & (termine2<>1) & (termine3<>1))
      repetir 3
        RecibirMensaje(quienSos,*)                        
        si quienSos=1
          RecibirMensaje(cantF,robCliente1)
          si cantF<>0
            RecibirMensaje(av,robCliente1)
            RecibirMensaje(ca,robCliente1)
          sino
            termine1:=1
        sino
          si quienSos=2
            RecibirMensaje(cantF,robCliente2) 
            si cantF<>0
              RecibirMensaje(av,robCliente2)
              RecibirMensaje(ca,robCliente2)
            sino
              termine2:=1
          sino
            si quienSos=3
              RecibirMensaje(cantF,robCliente3) 
              si cantF<>0
                RecibirMensaje(av,robCliente3)
                RecibirMensaje(ca,robCliente3)
              sino
                termine3:=1
        Pos(av,ca+1)
        repetir cantF
          depositarFlor
        Pos(100,100)
      si termine1<>1
        EnviarMensaje(1,robCliente1)
      si termine2<>1
        EnviarMensaje(1,robCliente2)
      si termine3<>1
        EnviarMensaje(1,robCliente3)
  fin
  
variables
  robServidor: tipoServidor
  robCliente1: tipoCliente
  robCliente2: tipoCliente
  robCliente3: tipoCliente
  
comenzar
  AsignarArea(robServidor, esqServidor)
  AsignarArea(robServidor, av1)
  AsignarArea(robServidor, av2)
  AsignarArea(robServidor, av3)
  AsignarArea(robCliente1, av1)
  AsignarArea(robCliente2, av2)
  AsignarArea(robCliente3, av3)
  Iniciar(robServidor, 100,100)
  Iniciar(robCliente1, 1,1)
  Iniciar(robCliente2, 2,1)  
  Iniciar(robCliente3, 3,1)
fin